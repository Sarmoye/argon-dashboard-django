<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Global</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<div class="container my-4">
    <h1 class="mb-4">Dashboard Global</h1>
    <!-- Vos indicateurs et autres éléments HTML ici -->
    
    <!-- Graphiques : Emplacement des canvas -->
    <div class="row">
        <div class="col-md-6">
            <canvas id="evolutionChart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="priorityChart"></canvas>
        </div>
    </div>
</div>

<!-- Injection des données JSON dans le template -->
<script id="evolution-labels" type="application/json">
    {{ evolution_labels|json_script:"evolution-labels" }}
</script>
<script id="evolution-counts" type="application/json">
    {{ evolution_counts|json_script:"evolution-counts" }}
</script>
<script id="priority-labels" type="application/json">
    {{ priority_labels|json_script:"priority-labels" }}
</script>
<script id="priority-values" type="application/json">
    {{ priority_values|json_script:"priority-values" }}
</script>

<!-- Inclusion de Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Code JavaScript pour récupérer les données et afficher les graphiques -->
<script>
    // Récupération des données injectées via json_script
    var evolutionLabels = JSON.parse(document.getElementById('evolution-labels').textContent);
    var evolutionCounts = JSON.parse(document.getElementById('evolution-counts').textContent);
    var priorityLabels  = JSON.parse(document.getElementById('priority-labels').textContent);
    var priorityValues  = JSON.parse(document.getElementById('priority-values').textContent);

    // Graphique d'évolution temporelle
    var ctx1 = document.getElementById('evolutionChart').getContext('2d');
    var evolutionChart = new Chart(ctx1, {
        type: 'line',
        data: {
            labels: evolutionLabels,
            datasets: [{
                label: 'Erreurs par jour',
                data: evolutionCounts,
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                fill: false,
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Date'
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Nombre d\'erreurs'
                    }
                }
            }
        }
    });

    // Histogramme des priorités
    var ctx2 = document.getElementById('priorityChart').getContext('2d');
    var priorityChart = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: priorityLabels,
            datasets: [{
                label: 'Répartition par priorité numérique',
                data: priorityValues,
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Priorité'
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Nombre d\'erreurs'
                    }
                }
            }
        }
    });
</script>
</body>
</html>
