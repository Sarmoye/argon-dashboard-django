{% extends 'layouts/base.html' %}

{% load static %}

{% block content %}
<div class="container">
    <h2>Création d'un Événement d'Erreur</h2>
    
    <form method="POST" action="{% url 'error_management_systems:create_event' %}">
        {% csrf_token %}
        
        <div class="form-group">
            <label>Système</label>
            <select name="system_name" class="form-control" required>
                <option value="">Sélectionner un système</option>
                {% for system in systems %}
                    <option value="{{ system.name }}">{{ system.name }}</option>
                {% endfor %}
                <option value="new">Nouveau Système</option>
            </select>
            <div id="new_system_fields" style="display:none;">
                <input type="text" name="new_system_name" placeholder="Nom du nouveau système" class="form-control">
                <select name="system_classification" class="form-control">
                    <option value="">Classification du système</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label>Service</label>
            <select name="service_name" class="form-control" required>
                <option value="">Sélectionner un service</option>
                {% for service in services %}
                    <option value="{{ service.name }}">{{ service.name }}</option>
                {% endfor %}
                <option value="new">Nouveau Service</option>
            </select>
            <div id="new_service_fields" style="display:none;">
                <input type="text" name="new_service_name" placeholder="Nom du nouveau service" class="form-control">
                <select name="service_classification" class="form-control">
                    <option value="">Classification du service</option>
                    <option value="primary">Primary</option>
                    <option value="secondary">Secondary</option>
                    <option value="tertiary">Tertiary</option>
                    <option value="external">External</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label>Catégorie d'Erreur</label>
            <select name="error_category_name" class="form-control" required>
                <option value="">Sélectionner une catégorie</option>
                {% for category in error_categories %}
                    <option value="{{ category.name }}">{{ category.name }}</option>
                {% endfor %}
                <option value="new">Nouvelle Catégorie</option>
            </select>
            <div id="new_category_fields" style="display:none;">
                <input type="text" name="new_category_name" placeholder="Nom de la nouvelle catégorie" class="form-control">
                <select name="severity_level" class="form-control">
                    <option value="1">Low</option>
                    <option value="2">Medium</option>
                    <option value="3">High</option>
                    <option value="4">Critical</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label>Code Erreur</label>
            <input type="text" name="error_code" class="form-control" required>
        </div>

        <div class="form-group">
            <label>Description de l'Erreur</label>
            <textarea name="error_description" class="form-control"></textarea>
        </div>

        <div class="form-group">
            <label>Détecté Par</label>
            <select name="detected_by" class="form-control">
                {% for choice in detected_by_choices %}
                    <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Source de l'Erreur</label>
            <select name="error_source" class="form-control">
                {% for choice in error_source_choices %}
                    <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Environnement</label>
            <select name="environment" class="form-control">
                {% for choice in environment_choices %}
                    <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Journal d'Événement</label>
            <textarea name="event_log" class="form-control"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Créer Événement</button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const systemSelect = document.querySelector('select[name="system_name"]');
    const newSystemFields = document.getElementById('new_system_fields');
    
    systemSelect.addEventListener('change', function() {
        newSystemFields.style.display = this.value === 'new' ? 'block' : 'none';
    });

    const serviceSelect = document.querySelector('select[name="service_name"]');
    const newServiceFields = document.getElementById('new_service_fields');
    
    serviceSelect.addEventListener('change', function() {
        newServiceFields.style.display = this.value === 'new' ? 'block' : 'none';
    });

    const categorySelect = document.querySelector('select[name="error_category_name"]');
    const newCategoryFields = document.getElementById('new_category_fields');
    
    categorySelect.addEventListener('change', function() {
        newCategoryFields.style.display = this.value === 'new' ? 'block' : 'none';
    });
});
</script>
{% endblock %}