{% extends 'layouts/base.html' %}

{% load static %}

{% block content %}
  <div class="container mt-4">
    <h1 class="mb-4">Liste des Tickets</h1>
    
    <form method="get" class="mb-4 row g-3">
      <div class="col-md-3">
        <label for="status" class="form-label">Statut:</label>
        <select name="status" id="status" class="form-select">
          <option value="">Tous</option>
          {% for value, display in status_choices %}
            <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>{{ display }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="col-md-3">
        <label for="priority" class="form-label">Priorité:</label>
        <select name="priority" id="priority" class="form-select">
          <option value="">Toutes</option>
          {% for value, display in priority_choices %}
            <option value="{{ value }}" {% if request.GET.priority == value %}selected{% endif %}>{{ display }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="col-md-3">
        <label for="system" class="form-label">Système:</label>
        <select name="system" id="system" class="form-select">
          <option value="">Tous</option>
          {% for system in systems %}
            <option value="{{ system }}" {% if request.GET.system == system %}selected{% endif %}>{{ system }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="col-md-3 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Filtrer</button>
      </div>
    </form>
    
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>Référence</th>
            <th>Système</th>
            <th>Priorité</th>
            <th>Statut</th>
            <th>Date de création</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for ticket in tickets %}
            <tr>
              <td>{{ ticket.ticket_reference }}</td>
              <td>{{ ticket.error_type.system_name }}</td>
              <td>{{ ticket.get_priorite_display }}</td>
              <td>{{ ticket.get_statut_display }}</td>
              <td>{{ ticket.date_creation }}</td>
              <td>
                <a href="{% url 'error_management_systems:ticket_detail' ticket.id %}" class="btn btn-info btn-sm">Détails</a>
                <a href="{% url 'error_management_systems:edit_ticket' ticket.id %}" class="btn btn-warning btn-sm">Modifier</a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="6" class="text-center">Aucun ticket trouvé.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}